// Generated by CoffeeScript 1.9.1

/*
Author Marek Pietrucha
https://github.com/mareczek/international-phone-number
 */

(function() {
  "use strict";
  angular.module("internationalPhoneNumber", []).directive('internationalPhoneNumber', function() {
    return {
      restrict: 'A',
      require: '^ngModel',
      scope: {
        ngModel: '=',
        options: '=internationalPhoneNumber'
      },
      link: function(scope, element, attrs, ctrl) {
        var options, read, watchOnce;
        read = function() {
          return ctrl.$setViewValue(element.val());
        };
        options = scope.options || {};
        watchOnce = scope.$watch('ngModel', function(newValue) {
          return scope.$$postDigest(function() {
            if (newValue !== null && newValue !== void 0 && newValue !== '') {
              element.val(newValue);
            }
            element.intlTelInput(options);
            if (!(options.skipUtilScriptDownload !== void 0 || options.utilsScript)) {
              element.intlTelInput('loadUtils', '/bower_components/intl-tel-input/lib/libphonenumber/build/utils.js');
            }
            return watchOnce();
          });
        });
        ctrl.$parsers.push(function(value) {
          if (!value) {
            return value;
          }
          return value.replace(/[^\d]/g, '');
        });
        ctrl.$parsers.push(function(value) {
          var validity;
          if (value) {
            validity = element.intlTelInput("isValidNumber");
            ctrl.$setValidity('international-phone-number', validity);
          } else {
            value = '';
            ctrl.$setValidity('international-phone-number', true);
          }
          return value;
        });
        element.on('blur keyup change', function(event) {
          return scope.$apply(read);
        });
        return element.on('$destroy', function() {
          return element.off('blur keyup change');
        });
      }
    };
  });

}).call(this);
